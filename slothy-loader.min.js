/**
* @preserve SlothyLoader - v1.0.0 - 2017-02-21
* @preserve LaziestLoader - v0.7.3 - 2016-01-03
* An lazy loader based on Josh Williamsâ€™s
* LaziestLoader, but without jQuery dependency
* See: http://sjwilliams.github.io/laziestloader/
* Copyright (c) 2016 Josh Williams; Licensed MIT
*/
var slothyLoader=function(options,callback){function getSource($el){var source,slug,data=$el.dataset;if(data.pattern&&data.widths&&Array.isArray(JSON.parse(data.widths))){source=retina3x?data.patternRetina3x:retina?data.patternRetina:data.pattern,source=source||data.patternRetina||data.pattern;var parsedWidths=JSON.parse(data.widths);"object"==typeof parsedWidths[0]?(slug=function(){for(var widths=parsedWidths.map(function(val){return val.size}),bestFitWidth=bestFit($el.offsetWidth,widths),i=parsedWidths.length-1;i>=0;i--)if(parsedWidths[i].size===bestFitWidth)return parsedWidths[i].slug}(),source=source.replace(options.sizePattern,slug)):source=source.replace(options.sizePattern,bestFit($el.offsetWidth,parsedWidths))}else source=retina3x?data.srcRetina3x:retina?data.srcRetina:data.src,source=source||data.src;return source}function onLoad($el){addClass($el,"ll-loaded"),removeClass($el,"ll-notloaded"),"function"==typeof callback&&callback.call($el)}function slEvListener(e){var source,$el=this;$el.dataset.ratio&&setHeight.call(this),options.setSourceMode&&(source=options.getSource($el),source&&this.getAttribute("src")!==source&&this.setAttribute("src",source)),addClass($el,"ll-loadstarted"),!options.setSourceMode||"IMG"!==this.nodeName&&"VIDEO"!==this.nodeName&&"AUDIO"!==this.nodeName?onLoad($el):"IMG"===this.nodeName?this.onload=function(){onLoad($el)}:this.onloadstart=function(){onLoad($el)}}function bindLoader(){for(var i=0;i<$elements.length;++i){var el=$elements[i];el.addEventListener("slothyloader",slEvListener)}}function unbindLoader(){for(var i=0;i<$elements.length;++i){var el=$elements[i];el.removeEventListener("slothyloader",slEvListener)}}function slothyloader(){for(var docEl=document.documentElement,wHeight=window.innerHeight||docEl.clientHeight,wWidth=window.innerWidth||docEl.clientWidth,threshold=options.threshold,$inview=[],i=0;i<$elements.length;++i){var el=$elements[i];if(!includesElement($loaded,el)){var rect=el.getBoundingClientRect();rect.bottom+threshold>0&&rect.right+threshold>0&&rect.left<wWidth+threshold&&rect.top<wHeight+threshold&&$inview.push(el)}}for(var i=0;i<$inview.length;++i){var inviewEl=$inview[i];inviewEl.dispatchEvent(slothyloaderEv),$loaded.push(inviewEl)}}function setHeight(){var $el=this,data=$el.dataset;if(data.ratio=data.ratio||data.heightMultiplier,data.ratio&&!isNaN(+data.ratio)){var newHeight=Math.round($el.offsetWidth*+data.ratio);newHeight>0&&($el.style.height=newHeight+"px")}}function hasClass(el,className){for(var classList=className.split(" "),i=0;i<classList.length;i++){var className=classList[i];return"undefined"!=typeof el.classList?el.classList.contains(className):!!el.className.match(new RegExp("(\\s|^)"+className+"(\\s|$)"))}}function addClass(el,className){for(var classList=className.split(" "),i=0;i<classList.length;i++){var className=classList[i];"undefined"!=typeof el.classList?el.classList.add(className):hasClass(el,className)||(el.className+=" "+className)}}function removeClass(el,className){for(var classList=className.split(" "),i=0;i<classList.length;i++){var className=classList[i];if("undefined"!=typeof el.classList)el.classList.remove(className);else if(hasClass(el,className)){var reg=new RegExp("(\\s|^)"+className+"(\\s|$)");el.className=el.className.replace(reg," ")}}}function includesElement(nodeList,searchElement,fromIndex){if(null==nodeList)throw new TypeError('"nodeList" is null or not defined');var o=Object(nodeList),len=o.length>>>0;if(0===len)return!1;for(var n=0|fromIndex,k=Math.max(n>=0?n:len-Math.abs(n),0);k<len;){if(o[k]===searchElement)return!0;k++}return!1}var slothyloaderEv=new CustomEvent("slothyloader"),$elements=null,$loaded=[],retina=window.devicePixelRatio>1,retina3x=window.devicePixelRatio>2,didScroll=!1,defaultOptions={selector:".dvz-lazy",threshold:0,sizePattern:/{{SIZE}}/gi,getSource:getSource,event:"scroll",scrollThrottle:250,sizeOffsetPercent:0,setSourceMode:!0};"undefined"==typeof options&&(options={});for(var x in defaultOptions)"undefined"!=typeof defaultOptions[x]&&"undefined"==typeof options[x]&&(options[x]=defaultOptions[x]);$elements=document.querySelectorAll(options.selector);for(var useNativeScroll="string"==typeof options.event&&0===options.event.indexOf("scroll"),bestFit=slothyLoader.bestFit=function(targetWidth,widths){var selectedWidth=widths[widths.length-1],i=widths.length,offset=targetWidth*(options.sizeOffsetPercent/100);for(widths.sort(function(a,b){return a-b});i--;)targetWidth-offset<=widths[i]&&(selectedWidth=widths[i]);return selectedWidth},i=0;i<$elements.length;++i){var el=$elements[i];addClass(el,"ll-init ll-notloaded"),setHeight.call(el)}return bindLoader(),useNativeScroll?(window.addEventListener("scroll",function(){didScroll=!0}),setInterval(function(){didScroll&&(didScroll=!1,slothyloader())},options.scrollThrottle)):"function"==typeof options.event?options.event(slothyloader):window.addEventListener(options.event,function(){slothyloader()}),window.addEventListener("resize",function(){$loaded=[],unbindLoader(),bindLoader(),slothyloader()}),document.addEventListener("DOMContentLoaded",function(){slothyloader()}),this};!function(){function CustomEvent(event,params){params=params||{bubbles:!1,cancelable:!1,detail:void 0};var evt=document.createEvent("CustomEvent");return evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail),evt}return"function"!=typeof window.CustomEvent&&(CustomEvent.prototype=window.Event.prototype,void(window.CustomEvent=CustomEvent))}(),"undefined"!=typeof module&&(module.exports=slothyLoader);